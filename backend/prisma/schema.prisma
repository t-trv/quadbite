generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model addresses {
  id           Int       @id @default(autoincrement())
  user_id      Int
  name         String    @db.VarChar(30)
  phone        String    @db.VarChar(30)
  address_line String    @db.VarChar(255)
  city         String    @db.VarChar(30)
  district     String    @db.VarChar(30)
  created_at   DateTime? @default(dbgenerated("(now())")) @db.DateTime(0)
  updated_at   DateTime? @default(dbgenerated("(now())")) @db.Timestamp(0)
  deleted_at   DateTime? @db.DateTime(0)
  users        users     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "addresses_ibfk_1")

  @@index([user_id], map: "addresses_ibfk_1")
}

model foods {
  id                Int             @id @default(autoincrement())
  side_category_id  String          @db.VarChar(20)
  name              String          @db.VarChar(100)
  slug              String          @unique(map: "slug_UNIQUE") @db.VarChar(50)
  image_url         String?         @db.VarChar(255)
  preparation_time  Int             @default(0)
  description       String          @db.Text
  short_description String?         @db.VarChar(100)
  price             Decimal         @default(0.00) @db.Decimal(10, 2)
  discount          Decimal?        @default(0.00) @db.Decimal(10, 2)
  is_active         Boolean?        @default(true)
  deleted_at        DateTime?       @db.DateTime(0)
  created_at        DateTime?       @default(dbgenerated("(now())")) @db.DateTime(0)
  updated_at        DateTime?       @default(dbgenerated("(now())")) @db.DateTime(0)
  food_variants     food_variants[]
  side_categories   side_categories @relation(fields: [side_category_id], references: [id], onDelete: Cascade, map: "foods_ibfk_1")
  order_items       order_items[]

  @@index([side_category_id], map: "side_category_id")
}

model main_categories {
  id              String            @id @db.VarChar(20)
  name            String            @db.VarChar(30)
  sort_order      Int               @default(0)
  path            String            @default("/") @db.VarChar(255)
  side_categories side_categories[]
}

model order_items {
  id         Int       @id @default(autoincrement())
  order_id   Int
  food_id    Int
  variant_id String    @db.VarChar(30)
  quantity   Int       @default(1)
  price      Decimal   @db.Decimal(10, 2)
  created_at DateTime? @default(dbgenerated("(now())")) @db.DateTime(0)
  updated_at DateTime? @db.DateTime(0)
  orders     orders    @relation(fields: [order_id], references: [id], onDelete: Cascade, map: "order_items_ibfk_1")
  foods      foods     @relation(fields: [food_id], references: [id], onDelete: Cascade, map: "order_items_ibfk_2")
  variants   variants  @relation(fields: [variant_id], references: [id], onDelete: Cascade, map: "order_items_ibfk_3")

  @@index([food_id], map: "food_id")
  @@index([order_id], map: "order_id")
  @@index([variant_id], map: "variant_id")
}

model order_statuses {
  id     String   @id @db.VarChar(30)
  name   String   @db.VarChar(30)
  orders orders[]
}

model orders {
  id               Int              @id @default(autoincrement())
  user_id          Int
  total_amount     Decimal          @db.Decimal(10, 2)
  order_status     String           @db.VarChar(30)
  payment_status   String           @db.VarChar(30)
  delivery_address String           @db.VarChar(255)
  phone            String           @db.VarChar(15)
  note             String?          @db.VarChar(255)
  created_at       DateTime?        @db.DateTime(0)
  updated_at       DateTime?        @db.DateTime(0)
  deleted_at       DateTime?        @db.DateTime(0)
  order_items      order_items[]
  users            users            @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "orders_ibfk_1")
  order_statuses   order_statuses   @relation(fields: [order_status], references: [id], onDelete: Cascade, map: "orders_ibfk_2")
  payment_statuses payment_statuses @relation(fields: [payment_status], references: [id], onDelete: Cascade, map: "orders_ibfk_3")

  @@index([payment_status], map: "payment_status")
  @@index([order_status], map: "status")
  @@index([user_id], map: "user_id")
}

model payment_statuses {
  id     String   @id @db.VarChar(30)
  name   String   @db.VarChar(30)
  orders orders[]
}

model roles {
  id         String       @id @unique(map: "id") @db.VarChar(30)
  name       String       @unique(map: "name") @db.VarChar(30)
  user_roles user_roles[]
}

model side_categories {
  id               String          @id @db.VarChar(20)
  main_category_id String          @db.VarChar(20)
  name             String          @unique(map: "name") @db.VarChar(50)
  foods            foods[]
  main_categories  main_categories @relation(fields: [main_category_id], references: [id], onDelete: Cascade, map: "side_categories_ibfk_1")

  @@index([main_category_id], map: "side_categories_ibfk_1")
}

model users {
  id            Int          @id @default(autoincrement())
  username      String       @unique(map: "username") @db.VarChar(50)
  hash_password String       @db.Text
  name          String?      @db.VarChar(50)
  avatar_url    String?      @db.Text
  email         String?      @unique(map: "email") @db.VarChar(255)
  phone         String?      @unique(map: "phone_UNIQUE") @db.VarChar(15)
  created_at    DateTime?    @default(dbgenerated("(now())")) @db.DateTime(0)
  updated_at    DateTime?    @default(dbgenerated("(now())")) @db.Timestamp(0)
  deleted_at    DateTime?    @db.DateTime(0)
  addresses     addresses[]
  orders        orders[]
  user_roles    user_roles[]

  @@index([deleted_at])
}

model variants {
  id            String          @id @unique(map: "id_UNIQUE") @db.VarChar(30)
  type          String          @db.VarChar(30)
  name          String          @db.VarChar(30)
  price_adjust  Decimal         @db.Decimal(10, 2)
  food_variants food_variants[]
  order_items   order_items[]
}

model user_roles {
  id      Int    @id @default(autoincrement())
  user_id Int
  role_id String @db.VarChar(30)
  users   users  @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "user_roles_ibfk_1")
  roles   roles  @relation(fields: [role_id], references: [id], onUpdate: Restrict, map: "user_roles_ibfk_2")

  @@unique([user_id, role_id], map: "user_role_index_16")
  @@index([role_id], map: "user_role_ibfk_2")
}

model food_variants {
  id         Int      @id @default(autoincrement())
  food_id    Int
  variant_id String   @db.VarChar(30)
  foods      foods    @relation(fields: [food_id], references: [id], onDelete: Cascade, map: "food_variants_ibfk_1")
  variants   variants @relation(fields: [variant_id], references: [id], onDelete: Cascade, map: "food_variants_ibfk_2")

  @@unique([food_id, variant_id], map: "food_variant_food_id_variant_id_key")
  @@index([food_id], map: "food_id")
  @@index([variant_id], map: "food_variant_ibfk_2")
}
